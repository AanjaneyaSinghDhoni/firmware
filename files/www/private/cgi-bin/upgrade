#!/usr/bin/haserl --upload-dir=/tmp --upload-limit=12000
content-type: text/plain

<%
path="$POST_firmware"

if [ ! -f "$path" ]; then
	echo "(E) Datei nicht gefunden."
	exit 1
fi

dir="`dirname $path`"
file="`basename $path`"

#make sure the file suffix is .bin
if [ "${file##*\.}" = "bin" ]; then
	echo "(I) Starte sysupgrade..."

	#apply openwrt or vendor image
	sysupgrade -n $path || rm -f "$path"
else
	echo "(E) Unbekanntes Dateiformat."
	exit 1
fi
%>
