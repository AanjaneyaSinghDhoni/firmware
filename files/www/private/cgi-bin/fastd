#!/usr/bin/haserl --upload-dir=/tmp --upload-limit=30
<%
get_ip() {
	ifconfig "$1" 2> /dev/null | awk -F':' '/inet addr/{split($2,_," ");print _[1]}'
}

[ -n "$GET_func" ] && func="$GET_func" || func="$POST_func"
case "$func" in
	get_settings)
		wan_interfaces=`uci -q get network.wan.ifname`
		wan_interface=${wan_interfaces%% *} #get first interface
		wan_ip=`get_ip $wan_interface`
		hostname=`uci get -q system.@system[0].hostname`

		echo "Content-Type: text/plain"
		echo
		uci export -qn fastd
		echo "package misc"
		echo "config data 'data'"
		echo "	option wan_ip '$wan_ip'"
		echo "	option hostname '$hostname'"
	;;
#	send_back_as_file_download)
#		name="$POST_name"
#		data="$POST_data"
#
#		#echo 'X-Download-Options: noopen'
#		echo 'Content-Type: text/plain; authoritative=true;'
#		echo 'Content-Disposition: attachment; filename="'$name'"'
#		echo
#		echo -n "$data"
#	;;
	*)
		send "(E) fastd: Invalid command: '$GET_func'"
	;;
esac
%>
