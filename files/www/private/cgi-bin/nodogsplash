#!/usr/bin/haserl 
<%

case $POST_func in
  get_status)
    ndsctl status
    ;;
  get_clients)
    ntsctl clients
    ;;
  auth|deauth|block|unblock|allow|unallow)
    func="$POST_func"
    macs="$POST_macs"
    fail=0
    for mac in $macs; do
      if [ `echo "$mac" | grep -c -E '^[[:xdigit:]]{1,2}(:[[:xdigit:]]{1,2}){5}$'` -eq 0 ]; then
        echo "(E) nodogsplash: Invalid MAC: '$mac'."
        exit
      fi
      
      ndsctl $func $mac &> /dev/null
      
      if [ $? != 0 ]; then
      	fail=$(($fail + 1))
      fi
    done
    
    if [ $fail -eq 0 ]; then
      echo "(I) nodogsplash: Alles ok"
    else
      echo "(E) nodogsplash: Something went wrong."  
    fi
    ;;
  *)
    echo "(E) nodogsplash: Invalid command: '$POST_func'"
    ;;
esac
%>
