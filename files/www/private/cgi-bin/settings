#!/usr/bin/haserl
content-type: text/plain

<%
. /lib/functions.sh

case "$GET_func" in
	get_settings)
		uci export -qn freifunk
		uci export -qn system
		uci export -qn wireless
		uci export -qn network

		#get the tagged port of the switch
		echo "package misc"
		echo "config data 'data'"
		port=`swconfig dev switch0 help 2> /dev/null | sed -rn 's/.*\(cpu @ ([0-9])\).*/\1/p'`
		echo "	option tagged_port '$port'"
	;;
	set_file)
		file_name="$GET_name"
		file_data="$GET_data"
		[ ! -f "/etc/config/$file_name" ] && exit 1
		echo "$file_data" > "/etc/config/$file_name" 2> /dev/null
		if [ $? -eq 0 ]; then
			echo "(I) Einstellungen wurden gespeichert. Bitte Neustarten."
		else
			echo "(E) Beim Speichern ist ein Fehler aufgetreten. Bitte Neustarten."
		fi
	;;
	*)
		echo "(E) settings: Invalid command: '$GET_func'"
	;;
esac
%>
