#!/usr/bin/haserl
<%

case $POST_func in
    set_mac)
        new_mac="$POST_new_mac"
        
        #reset mac if string is empty
        if [ -z "$new_mac" ]; then
            new_mac=$(ifconfig ${bat_interfaces%% *} | grep HWaddr | awk '{print $5}')
        fi
        
        #check if mac format is valid
        if [ `echo "$new_mac" | grep -c -E '^[[:xdigit:]]{1,2}(:[[:xdigit:]]{1,2}){5}$'` -eq 0 ]; then
            echo "(E) Invalid MAC received: '$new_mac'."
        fi
        
        #set mac of br-mesh and batmans primary interface
        ifconfig ff_dummy1 hw ether $new_mac up &> /dev/null
        ifconfig ff_dummy2 hw ether $new_mac up &> /dev/null
    ;;
    get_mac)
        echo $(ifconfig br-mesh | grep HWaddr | awk '{printf "%s", $5}')
    ;;
esac
%>
